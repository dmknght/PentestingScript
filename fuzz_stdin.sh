#!/binb/bash
# https://ryanstutorials.net/bash-scripting-tutorial/bash-variables.php
# https://shapeshed.com/unix-exit-codes/
# https://stackoverflow.com/a/5349842

program=$1
f_msg=`echo "A" | ./$program`
f_sig="$?"

echo "=============================="
echo "Stdout: \"$f_msg\""
echo "SIG: $f_sig"
echo "=============================="
# Get test return signal

for i in {2..4000}; do
	stdin=$(printf '%*s' $i '')
	output=`echo "${stdin// /*}" |./$program`
	sig=$?

	if [ "$sig" != "$f_sig" ]; then
		echo "Recv SIG: $sig at length $i"
		echo "Stdout: \"$output\""

		if [ "$sig" > 128 ]; then
			echo "******************************"
			echo "$program has crashed"
			echo "******************************"
		fi
		break
	elif [ "$output" != "$f_msg" ]; then
		echo "------------------------------"
		echo "Stdout: \"$output\" at length $i"
		echo "------------------------------"
		f_msg=$output
	fi
	
done
